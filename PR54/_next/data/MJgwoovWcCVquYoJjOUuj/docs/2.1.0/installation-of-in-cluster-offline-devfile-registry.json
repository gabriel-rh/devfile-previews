{"pageProps":{"markdoc":{"content":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["A devfile refers to various resources, such as container images and"," ","starter projects. The current devfile registry currently does not store"," ","those supporting resources. Therefore, you must have access to those"," ","resources when using those devfiles."]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To support the air gap installation of the devfile registry, the air gap"," ","scenario divides into two stages:"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Build a devfile registry based on one or more source repositories so"," ","that the registry contains all the resources available for offline"," ","installation."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Install the devfile registry to a cluster to make it available for"," ","users to access the registry."]}]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"stage-1-build-and-package-a-devfile-registry"},"children":["Stage 1: Build and Package a Devfile Registry"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["The main goal of this stage is:"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Pull in resources into the registry as part of the registry build."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Modify the devfile to update references to those offline resources"," ","as part of the registry build."]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"prerequisites"},"children":["Prerequisites"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Golang 1.17.x or higher"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Docker 17.05 or higher or Podman 4.0.x or higher"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Git"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Curl"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Archive Tools (such as ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["unzip"]},")"]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"create-offline-registry"},"children":["Create Offline Registry"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Download / clone the"," ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"https://github.com/devfile/registry"},"children":["devfile/registry"]}," repository."]},{"$$mdtype":"Tag","name":"h4","attributes":{},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Clone through HTTPS"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ git clone https://github.com/devfile/registry.git /path/to/registry\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Clone through SSH"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ git clone git@github.com:devfile/registry.git /path/to/registry\n"]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"install-stack-images"},"children":["Install Stack Images"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["You will first need to collect all the image tags used in the stacks"," ","needed for offline access. The image tags collected are to each be"," ","pulled, re-tagged, and installed into the image repository accessible by"," ","the offline cluster. Procedure here will require you to ",{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["change the"," ","devfile"]},"."]},{"$$mdtype":"Tag","name":"h4","attributes":{},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Use the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["docker pull"]}," or the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["podman pull"]}," to pull down an image for"," ","a stack component:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ podman pull registry.access.redhat.com/ubi8/nodejs-16:latest\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Use the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["docker tag"]}," or the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["podman tag"]}," to re-tag the image that"," ","uses the form ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["<registry_host>:<port>/<project>/<image>"]},":"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ podman tag registry.access.redhat.com/ubi8/nodejs-16:latest \\\n    <registry_host>:<port>/<project>/nodejs-16:latest\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Use the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["docker push"]}," or ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["podman push"]}," to push the re-tagged image"," ","to the image repository at ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["<registry_host>:<port>"]},":"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ podman push <registry_host>:<port>/<project>/nodejs-16:latest\n"]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"packaging-starter-projects"},"children":["Packaging Starter Projects"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To package starter projects you will need to download them manually then"," ","place them under ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["/stacks/<stack>/<zip>-offline.zip"]},". Procedure here"," ","will require you to ",{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["change the devfile"]},"."]},{"$$mdtype":"Tag","name":"Callout","attributes":{"title":"Note!","type":"note"},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Starter projects must be packaged under an archive with the"," ","suffix ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["-offline"]}," to be pulled into the registry."]}]},{"$$mdtype":"Tag","name":"h4","attributes":{},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["zip"]}," - Download archive"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session","title":"Example"},"children":["$ cd /path/to/registry\n$ curl -L https://code.quarkus.io/d?e=io.quarkus%3Aquarkus-resteasy&e=io.quarkus%3Aquarkus-micrometer&e=io.quarkus%3Aquarkus-smallrye-health&e=io.quarkus%3Aquarkus-openshift&cn=devfile \\\n    -o stacks/java-quarkus/community-offline.zip\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["git"]}," - Package cloned contents into a directory then archive"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session","title":"Example"},"children":["$ cd /path/to/registry\n$ git clone https://github.com/odo-devfiles/nodejs-ex.git \\\n    stacks/nodejs/nodejs-starter-offline\n$ cd stacks/nodejs\n$ zip -r nodejs-starter-offline.zip nodejs-starter-offline\n"]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"modify-devfile"},"children":["Modify Devfile"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Change the devfile so you can update references to those offline"," ","resources as part of the registry build. For all the items pulled into"," ","the registry, update the corresponding devfile entries to reference the"," ","resources within the offline version in the registry:"]},{"$$mdtype":"Tag","name":"Callout","attributes":{"title":"Note!","type":"note"},"children":[{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["All location references to ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["starterProjects"]}," will change to local"," ","paths relative to the stacks directory."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Stack component image references will change to use the offline"," ","accessible image repository."]}]}]}]},{"$$mdtype":"Tag","name":"h4","attributes":{},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Under ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["starterProjects"]},", find the starter project definition you"," ","want to make offline."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Under the definition for the starter project find either ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["git"]}," or"," ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["zip"]},":"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"yaml","title":"Before: Starter Project","filename":"devfile.yaml"},"children":["starterProjects:\n - name: nodejs-starter\ngit:\n  remotes:\n  origin: https://github.com/odo-devfiles/nodejs-ex.git\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Do one of the following depending on the block type:"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["If ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["git"]},", replace all of the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["git"]}," block with a ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["zip"]}," block and"," ","add the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["location"]}," to be the path to the local file under the"," ","stack root directory (",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["<registry_root>/stacks/<stack>/"]},")."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["If ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["zip"]},", replace the value of ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["location"]}," to the local file"," ","under the stack root directory"," ","(",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["<registry_root>/stacks/<stack>/"]},")."]}]}]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"verification-step"},"children":["Verification step"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To confirm you modified your devfile, verify your altered starter"," ","project definition is similar to the following example:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"yaml","title":"After: Starter Project","filename":"devfile.yaml"},"children":["starterProjects:\n  - name: nodejs-starter\n  zip:\n    location: nodejs-starter-offline.zip\n"]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"build-registry"},"children":["Build Registry"]},{"$$mdtype":"Tag","name":"h4","attributes":{},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["If not already at the root of the registry, change to the root of"," ","the registry."]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ cd /path/to/registry\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Build the registry image."]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ bash .ci/build.sh\n"]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"additional-resources"},"children":["Additional resources"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To create your own registry Git repository, see ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"./building-a-custom-devfile-registry"},"children":["Building a custom"," ","devfile registry"]}]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["For more on interacting with the OpenShift Image Registry, see"," ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"https://docs.openshift.com/container-platform/4.10/registry/accessing-the-registry.html"},"children":["Accessing the"," ","registry"]}]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To learn more about starter projects in devfiles, see ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"./adding-projects"},"children":["Adding"," ","projects to a devfile"]}]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["For more information about building your own registry image, see"," ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"./building-a-custom-devfile-registry"},"children":["Building a custom devfile"," ","registry"]}]}]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"stage-2-install-a-devfile-registry-to-a-cluster"},"children":["Stage 2: Install a Devfile Registry to a cluster"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["In this stage, you will push the container images to a registry"," ","available to the offline cluster."]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"prerequisites-2"},"children":["Prerequisites"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Docker 17.05 or higher or Podman 4.0.x or higher"]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"install-image-into-cluster-image-registry"},"children":["Install Image into Cluster Image Registry"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["The process of installing the built images into an offline image"," ","registry depends on which image registry has deployed and which image"," ","registry you have access to."]},{"$$mdtype":"Tag","name":"h4","attributes":{},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Use the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["docker tag"]}," or the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["podman tag"]}," to re-tag the image using"," ","the form ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["<registry_host>:<port>/<project>/<image>"]},":"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ podman tag devfile-index <registry_host>:<port>/<project>/devfile-index\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Use the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["docker push"]}," or ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["podman push"]}," to push the re-tagged image"," ","to the cluster image registry at ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["<registry_host>:<port>"]},":"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ podman push <registry_host>:<port>/<project>/devfile-index\n"]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"additional-resources-2"},"children":["Additional resources"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["For more on interacting with the OpenShift Image Registry, see"," ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"https://docs.openshift.com/container-platform/4.10/registry/accessing-the-registry.html"},"children":["Accessing the"," ","registry"]}]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"update-strategy-for-refreshing-registry-contents"},"children":["Update strategy for refreshing registry contents"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Steps to update an already deployed registry in the air gap scenario:"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Follow offline registry instructions in the above sections and rerun"," ","the registry build script to rebuild the devfile registry."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Update the existing offline devfile registry deployment with a newly"," ","built and updated offline devfile registry image."]}]}]}],"frontmatter":{"title":"Installation of in-cluster offline devfile registry","description":"Installation of in-cluster offline devfile registry"},"file":{"path":"/docs/2.1.0/installation-of-in-cluster-offline-devfile-registry.md"}}},"__N_SSG":true}