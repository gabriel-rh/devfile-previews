{"pageProps":{"markdoc":{"content":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Provide your developers a devfile registry so they can access devfile"," ","stacks and samples, enabling them to use devfiles to simplify and"," ","improve their containerized application development."]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To create a devfile registry for your team’s container development:"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Create a Git repository."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Build a devfile registry."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Tag and push the registry container image."]}]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"creating-a-git-repository"},"children":["Creating a Git repository"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Set up a Git repository to store the devfile stacks to package into the"," ","devfile registry."]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"procedure"},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Fork the ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"https://github.com/devfile/registry"},"children":["devfile/registry"]}," ","repository."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Name your forked repository."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Add or remove any stacks you need from this repository."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Create a ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["stacks/"]}," directory for storing the devfile stacks. Each"," ","directory under ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["stacks/"]}," must correspond to a specific stack, for"," ","example, ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["stacks/java-wildfly/"]},"."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To package any external devfile stacks or samples in your devfile"," ","registry, go to the root of your repository and create an"," ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["extraDevfileEntries.yaml"]}," file."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Add your devfile stacks to your ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["stacks/"]}," directory."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Verify every devfile stack contains at least one ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["devfile.yaml"]}," ","file. Add other required files to the stacks. These files can"," ","include VSX plug-ins, Dockerfiles, or Kubernetes manifests."]}]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["The registry build tool automatically validates your customized"," ","registry."]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"additional-resources"},"children":["Additional resources"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Example of"," ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"https://github.com/devfile/registry/blob/main/extraDevfileEntries.yaml"},"children":["extraDevfileEntries.yaml"]},"."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To create devfile stacks, see ","."]}]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"building-a-custom-devfile-registry"},"children":["Building a custom devfile registry"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Make your repository into a devfile registry by building a"," ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["devfile index"]}," container image. Deploy the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["devfile index"]}," image to"," ","your cloud or cluster to form the devfile registry."]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"prerequisites"},"children":["Prerequisites"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Golang 1.13.x or higher"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Docker 17.05 or higher"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Git"]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"procedure-2"},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Run ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["./build_image.sh <path-to-devfile-registry-folder>"]}," to build a"," ","devfile registry repository."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["In a multi-stage Docker build, add a Dockerfile to your devfile"," ","registry repository. Make sure the Dockerfile contains the"," ","following:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"docker","filename":"Dockerfile"},"children":["FROM quay.io/openshift-pipeline/golang:1.15-alpine AS builder\n# Install dependencies\nRUN apk add --no-cache git bash\nCOPY . /registry\n# Download the registry build tools\nRUN git clone https://github.com/devfile/registry-support.git /registry-support\n# Run the registry build tools\nRUN /registry-support/build-tools/build.sh /registry /build\nFROM quay.io/devfile/devfile-index-base:next\nCOPY --from=builder /build/index.json /index.json\nCOPY --from=builder /build/stacks /stacks\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Run ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["docker build -t devfile-index"]}," to build the devfile registry"," ","into a container image."]}]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["The build script builds the index generator, generates the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["index.json"]}," ","file from the specified devfile registry, and builds the stacks and"," ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["index.json"]}," into a devfile index container image. The registry build"," ","process takes the contents of your devfile registry Git repository and:"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Packages the content of each devfile stack based on the supported"," ","media types for the devfile registry."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Validates the content of the devfile registry repository based on"," ","the expected registry structure."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Generates ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["index.json"]}," from the stacks in the repository and from"," ","any extra stacks or samples mentioned in the"," ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["extraDevfileEntries.yaml"]}," file."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Builds a devfile index container image with the devfile stack"," ","contents and ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["index.json"]},"."]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"additional-resources-2"},"children":["Additional resources"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["For examples on how to add Dockerfiles to your devfile registry, see"," ","the ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"https://github.com/devfile/registry/blob/master/.ci/Dockerfile"},"children":["devfile/registry repository’s"," ","Dockerfile"]},"."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To run the registry build outside a container build, see the"," ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"https://github.com/devfile/registry-support/tree/master/build-tools"},"children":["devfile registry build"," ","tools"]},"."]}]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"tagging-and-pushing-a-registry-container-image"},"children":["Tagging and pushing a registry container image"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Use the devfile index container image to create a container in which you"," ","build, run, and deploy your application."]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"procedure-3"},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Choose a container registry."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Consult the documentation for your container registry and log in to"," ","the registry with the Docker CLI."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Push the devfile index container image to your chosen container"," ","registry:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"shell-session"},"children":["$ docker tag -f devfile-index __<registry-hostname>__/__<registry-username>__/devfile-index:latest\n$ docker push __<registry-hostname>__/__<registry-username>__/devfile-index:latest\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["If your container does not build properly, consult the documentation"," ","for your container registry."]}]}]},{"$$mdtype":"Tag","name":"h3","attributes":{"id":"additional-resources-3"},"children":["Additional resources"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["For information on deploying the devfile index container image, see ","."]}]}],"frontmatter":{"title":"Building a custom devfile registry","description":"Building a custom devfile registry"},"file":{"path":"/docs/2.0.0/building-a-custom-devfile-registry.md"}}},"__N_SSG":true}