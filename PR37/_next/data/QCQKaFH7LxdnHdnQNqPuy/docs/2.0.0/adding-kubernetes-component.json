{"pageProps":{"markdoc":{"content":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["This section describes how to add a ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["kubernetes"]}," component to a devfile."," ","A complex component type that allows to apply configuration from a list"," ","of Kubernetes or OpenShift components."]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"prerequisites"},"children":["Prerequisites"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"Link","attributes":{"href":"./versions"},"children":["Adding schema version"]}]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"Link","attributes":{"href":"./metadata"},"children":["Adding a name"]}]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"Link","attributes":{"href":"./adding-components"},"children":["Adding components"]}]}]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"procedure"},"children":["Procedure"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Define a component using the type ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["kubernetes"]},"."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["The content can be provided through the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["reference"]}," attribute, which"," ","points to the file with the component content."]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"yaml","title":"Adding kubernetes component using the reference attribute","filename":"devfile.yaml"},"children":["components:\n  - name: mysql\n    kubernetes:\n      reference: petclinic.yaml\n      selector:\n        app.kubernetes.io/name: mysql\n        app.kubernetes.io/component: database\n        app.kubernetes.io/part-of: petclinic\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Alternatively, to post a devfile with such components to REST API,"," ","the contents of the Kubernetes or OpenShift list can be embedded"," ","into the devfile using the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["referenceContent"]}," field:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"yaml","title":"Adding kubernetes component using the referenceContent attribute","filename":"devfile.yaml"},"children":["components:\n  - name: mysql\n    kubernetes:\n      reference: petclinic.yaml\n      referenceContent: |\n            kind: List\n            items:\n            -\n              apiVersion: v1\n              kind: Pod\n              metadata:\n              name: ws\n              spec:\n              containers:\n              ... etc\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Overriding container entrypoints. As with the ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"#adding-container-component.adoc"},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["container"]}," ","component"]},", it is"," ","possible to override the entrypoint of the containers contained in"," ","the Kubernetes or OpenShift list using the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["command"]}," and ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["args"]}," ","properties (as"," ",{"$$mdtype":"Tag","name":"Link","attributes":{"href":"https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/#notes"},"children":["understood"]}," ","by Kubernetes)."]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["There can be more containers in the list (contained in Pods or Pod"," ","templates of deployments). It is therefore necessary to select which"," ","containers to apply the entrypoint changes to as follows:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"yaml","title":"Overriding container entrypoints","filename":"devfile.yaml"},"children":["components:\n  - name: appDeployment\n    kubernetes:\n      reference: app-deployment.yaml\n      entrypoints:\n      - parentName: mysqlServer\n        command: ['sleep']\n        args: ['infinity']\n      - parentSelector:\n        app: prometheus\n        args: ['-f', '/opt/app/prometheus-config.yaml']\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["The ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["entrypoints"]}," list contains constraints for picking the"," ","containers along with the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["command"]}," and ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["args"]}," parameters to apply"," ","to them. In the example above, the constraint is"," ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["parentName: mysqlServer"]},", which will cause the command to be"," ","applied to all containers defined in any parent object called"," ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["mysqlServer"]},". The parent object is assumed to be a top level object"," ","in the list defined in the referenced file, which is"," ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["app-deployment.yaml"]}," in the example above."]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Other types of constraints (and their combinations) are possible:"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["containerName"]}," the name of the container"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["parentName"]}," the name of the parent object that (indirectly) contains the"," ","containers to override"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["parentSelector"]}," the set of labels the parent object needs to have"]}]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["A combination of these constraints can be used to precisely locate"," ","the containers inside the referenced Kubernetes list."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Overriding container environment variables"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To provision or override entrypoints in a Kubernetes or OpensShift"," ","component, configure it in the following way:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"yaml","title":"Overriding container environment variables","filename":"devfile.yaml"},"children":["components:\n  - name: appDeployment\n    kubernetes:\n      reference: app-deployment.yaml\n      env:\n        - name: ENV_VAR\n          value: value\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["This is useful for temporary content or without access to editing"," ","the referenced content. The specified environment variables are"," ","provisioned into each init container and containers inside all Pods"," ","and Deployments."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Specifying mount-source option"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["To specify a project sources directory mount into container(s), use"," ","the ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["mountSources"]}," parameter:"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"yaml","title":"Specifying mount-source option","filename":"devfile.yaml"},"children":["components:\n  - name: appDeployment\n    kubernetes:\n      reference: app-deployment.yaml\n      mountSources: true\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["If enabled, project sources mounts will be applied to every"," ","container of the given component. This parameter is also applicable"," ","for ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["plugin"]}," type components."]}]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"additional-resources"},"children":["Additional resources"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"Link","attributes":{"href":"./devfile-schema"},"children":["API reference"]}]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"Link","attributes":{"href":"./devfile-samples"},"children":["Devfile samples"]}]}]}]}],"frontmatter":{"title":"Adding kubernetes component","description":"Adding kubernetes component"},"file":{"path":"/docs/2.0.0/adding-kubernetes-component.md"}}},"__N_SSG":true}